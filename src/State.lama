import Collection;
-- States: partial maps from variables into values

-- Empty state (undefined everywhere)
public fun emptyState (x) {
  emptyMap()
}

public infix <- before : (st, [x, v]) {
  st.removeMap(x).addMap(x, v)
}

public fun get (st, y) {
  case st.findMap(y) of
      Some(s) -> s
    | None    -> failure ("undefined variable ""%s""\n", y)
  esac
}